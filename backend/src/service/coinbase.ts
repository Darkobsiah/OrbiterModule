import axios from 'axios'
import { BigNumber } from 'bignumber.js'
import { equalsIgnoreCase } from '../util'
import { errorLogger } from '../util/logger'

let exchangeRates: { [key: string]: string } | undefined

/**
 * @param sourceCurrency
 * @returns
 */
export async function getExchangeToUsdRate(
  sourceCurrency = 'ETH'
): Promise<BigNumber> {
  // toUpperCase
  sourceCurrency = sourceCurrency.toUpperCase()

  const currency = 'USD'

  let rate = -1
  try {
    if (!exchangeRates) {
      exchangeRates = await cacheExchangeRates(currency)
    }
    if (exchangeRates?.[sourceCurrency]) {
      rate = Number(exchangeRates[sourceCurrency])
    }
  } catch (error) {
    errorLogger.error(error)
  }

  return new BigNumber(rate)
}

/**
 * @param value
 * @param sourceCurrency
 * @returns
 */
export async function exchangeToUsd(
  value: string | number | BigNumber,
  sourceCurrency: string
): Promise<BigNumber> {
  if (!(value instanceof BigNumber)) {
    value = new BigNumber(value)
  }

  const rate = await getExchangeToUsdRate(sourceCurrency)
  if (rate.comparedTo(0) !== 1) {
    return new BigNumber(0)
  }

  return value.dividedBy(rate)
}

/**
 *
 * @param currency
 * @returns
 */
export async function cacheExchangeRates(currency = 'USD'): Promise<any> {
  // cache
  exchangeRates = await getRates(currency)
  if (exchangeRates) {
    let metisExchangeRates = await getRates('metis')
    if (metisExchangeRates && metisExchangeRates["USD"]) {
      let usdToMetis = 1 / Number(metisExchangeRates["USD"])
      exchangeRates["METIS"] = String(usdToMetis)
    }
    return exchangeRates
  } else {
    return undefined
  }
}
async function getRates(currency) {
  // const resp = await axios.get(
  //   `https://api.coinbase.com/v2/exchange-rates?currency=${currency}`
  // )
  // const data = resp.data?.data
  // // check
  // if (!data || !equalsIgnoreCase(data.currency, currency) || !data.rates) {
  //   return undefined
  // }
  // return data.rates
  return {
    "AED": "3.6730199999999994",
"AFN": "88.2162950000003264",
"ALL": "113.167219000000046",
"AMD": "480.1390482683785224",
"ANG": "1.7999425098362358",
"AOA": "427.8231000000010782",
"ARS": "125.0448598434688444",
"AUD": "1.4541013",
"AWG": "1.7974858924319732",
"AZN": "1.7",
"BAM": "1.8579530000000001",
"BBD": "2.0179740000000001",
"BDT": "93.3993579999998828",
"BGN": "1.8686",
"BHD": "0.376989",
"BIF": "2056.7667626491155903",
"BMD": "1",
"BND": "1.3878306680045354",
"BOB": "6.8712960000000014",
"BRL": "5.2441987362529885",
"BSD": "0.9994871",
"BTN": "78.9235459717816754",
"BWP": "12.2937640000000053",
"BYN": "3.380147",
"BYR": "33801.4700000000053908",
"BZD": "2.0146490000000002",
"CAD": "1.2882849294625353",
"CDF": "1998.8007195682590446",
"CHF": "0.953820858516986",
"CLF": "0.03366716",
"CLP": "927.4999999999698563",
"CNY": "6.7008999999999992",
"COP": "4123.23",
"CRC": "686.1130099999830431",
"CUC": "1",
"CVE": "104.3500000000000193",
"CZK": "23.6423387001442183",
"DJF": "177.91568",
"DKK": "7.1078300000000003",
"DOP": "54.5173335136039828",
"DZD": "146.1881441415101235",
"EGP": "18.7995999999999962",
"ETB": "52.1225599999999253",
"EUR": "0.9553744590192126",
"FJD": "2.2021333827785682",
"FKP": "0.823716",
"GBP": "0.82358",
"GEL": "2.9400000000000001",
"GHS": "7.9502989999999994",
"GIP": "0.823716",
"GMD": "54.0540540540540541",
"GNF": "8681.8532000033724284",
"GTQ": "7.7433009025823831",
"GYD": "208.6711197083612431",
"HKD": "7.8465000000000019",
"HNL": "24.5637370000000072",
"HRK": "7.1932999999999994",
"HTG": "115.1554590000002924",
"HUF": "376.7469999999970164",
"IDR": "14872.9000000094539589",
"ILS": "3.4598900000000001",
"INR": "78.9506511060196713",
"IQD": "1457.7259475218658892",
"ISK": "133.28",
"JMD": "150.5144584188757172",
"JOD": "0.7089911707911519",
"JPY": "136.3880000000005766",
"KES": "117.8000000000006291",
"KGS": "79.499344",
"KHR": "4065.8161000005929413",
"KMF": "464.6300000000085594",
"KRW": "1299.0999999999279649",
"KWD": "0.3066802628249852",
"KYD": "0.8325199613311128",
"KZT": "467.972529999997503",
"LAK": "14925.373134328358209",
"LBP": "1510.1177891875566294",
"LKR": "359.7769382982550818",
"LRD": "152.4934199089309296",
"LSL": "16.117549803631832",
"LYD": "4.8052342455590025",
"MAD": "10.1061099999999982",
"MDL": "19.0985485103132162",
"MGA": "4072.6044999995981885",
"MKD": "58.7797580000000792",
"MMK": "1850.1387604070305273",
"MNT": "3127.2388000002235463",
"MOP": "8.0786409999999995",
"MUR": "44.9023900000000262",
"MVR": "13.7000000000000014",
"MWK": "1025.7462303826033439",
"MXN": "20.1720000000000003",
"MYR": "4.3997972573423817",
"MZN": "63.8800000000001347",
"NAD": "15.8227848101265823",
"NGN": "415.1000000000008634",
"NIO": "35.8293105974860006",
"NOK": "9.8803",
"NPR": "126.2763380872165412",
"NZD": "1.60833",
"OMR": "0.384995",
"PAB": "0.998922661909131",
"PEN": "3.7866653337604692",
"PGK": "3.5669700000000005",
"PHP": "54.9414928043126874",
"PKR": "204.8909900000019535",
"PLN": "4.4688463315687349",
"PYG": "6849.3150684931506849",
"QAR": "3.6409989590383976",
"RON": "4.7221000000000003",
"RSD": "112.1499999999998929",
"RUB": "53.4399567350110273",
"RWF": "1021.4504596527068437",
"SAR": "3.7521959999999996",
"SBD": "8.1599689999999967",
"SCR": "12.7266602278250354",
"SEK": "10.2208897816041155",
"SHP": "0.8145312372729494",
"SLL": "13157.8947368421052632",
"SOS": "575.6820392960560023",
"SRD": "22.2529999999999897",
"SSP": "130.2600000000002694",
"STD": "21980.4905040128028789",
"SVC": "8.7456299999999973",
"SZL": "16.1128544324448437",
"THB": "35.2140000000000174",
"TJS": "9.6943069999999995",
"TMT": "3.5035841666024343",
"TND": "3.0639999999999996",
"TOP": "2.3440000000000001",
"TRY": "16.6390984537119416",
"TTD": "6.7894562460281681",
"TWD": "29.7070000000000271",
"TZS": "2333.0000000001623768",
"UAH": "29.675689",
"UGX": "3756.5740045078888054",
"UYU": "39.4639688045219394",
"UZS": "10853.8507000046883398",
"VES": "4031330.0003328911061075",
"VND": "23255.813953488372093",
"VUV": "116.804417",
"WST": "2.6639260000000003",
"XAF": "626.660347",
"XAG": "0.0481521608282172",
"XAU": "0.00055",
"XBA": "4.0718740519816389",
"XCD": "2.7026",
"XDR": "0.731803",
"XOF": "625",
"XPD": "0.0005041593143433",
"XPF": "113.1999999999999864",
"XPT": "0.0010917030567686",
"XTS": "4433.6204898878063337",
"YER": "250.2999999999990263",
"ZAR": "16.26939999999999",
"ZMW": "17.1150408005457644",
"JEP": "0.823716",
"GGP": "0.823716",
"IMP": "0.823716",
"GBX": "53.3601699414692296",
"CNH": "6.6999596595428899",
"ZWD": "481.1668",
"ZWL": "322",
"VEF": "403133000033.2891106107488816",
"SGD": "1.3922535015175563",
"USD": "1.0",
"BTC": "0.000050059595949",
"BCH": "0.0095351609058403",
"BSV": "0.0178165783261325",
"ETH": "0.0009082280924031",
"ETH2": "0.0009082280924031",
"ETC": "0.0668002672010688",
"LTC": "0.0191277735271614",
"ZRX": "2.8886372564878793",
"USDC": "1",
"BAT": "2.6420079260237781",
"LOOM": "24.0384615384615385",
"MANA": "1.1555350127108851",
"KNC": "0.7815858376646215",
"LINK": "0.1614987080103359",
"DNT": "20.5128205128205128",
"MKR": "0.001097249196265",
"CVC": "7.342143906020558",
"OMG": "0.5479452054794521",
"GNT": "5.4377985181455258",
"DAI": "1.0001500225033755",
"SNT": "35.2982703847511472",
"ZEC": "0.0168662506324844",
"XRP": "3.0838431260103634",
"REP": "0.1306335728282169",
"XLM": "9.247870677776442",
"EOS": "1.0810810810810811",
"XTZ": "0.6788866259334691",
"ALGO": "3.3738191632928475",
"DASH": "0.0224517287831163",
"ATOM": "0.1410934744268078",
"OXT": "9.7847358121330724",
"COMP": "0.021468441391155",
"ENJ": "1.949317738791423",
"REPV2": "0.1306335728282169",
"BAND": "0.7468259895444361",
"NMR": "0.0726216412490922",
"CGLD": "1.1689070718877849",
"UMA": "0.393623302499508",
"LRC": "2.6174584478471404",
"YFI": "0.0001823850677697",
"UNI": "0.1972386587771203",
"BAL": "0.2132196162046908",
"REN": "9.0293453724604966",
"WBTC": "0.0000501255017249",
"NU": "5.8788947677836567",
"YFII": "0.0011145476329795",
"FIL": "0.185563184264242",
"AAVE": "0.0168236877523553",
"BNT": "2.0216314565854645",
"GRT": "10.1522842639593909",
"SNX": "0.3902439024390244",
"STORJ": "1.3929516645772392",
"SUSHI": "0.9569377990430622",
"MATIC": "2.0437359493153485",
"SKL": "19.7044334975369458",
"ADA": "2.1699034392969513",
"ANKR": "36.8527731711811314",
"CRV": "1.4356471179384107",
"ICP": "0.1863064741499767",
"NKN": "11.1669458403126745",
"OGN": "3.7664783427495292",
"1INCH": "1.4265335235378031",
"USDT": "1.0012465519571867",
"FORTH": "0.352112676056338",
"CTSI": "6.3431652394544878",
"TRB": "0.0898876404494382",
"POLY": "5.1519835136527563",
"MIR": "4.6008741660915574",
"RLC": "1.2737230925996688",
"DOT": "0.1414727311310745",
"SOL": "0.0295159386068477",
"DOGE": "15.1217299259035234",
"MLN": "0.0419375131054728",
"GTC": "0.3378378378378378",
"AMP": "117.3708920187793427",
"SHIB": "103039.6702730551262236",
"CHZ": "9.910802775024777",
"KEEP": "5.1400668208686713",
"LPT": "0.1004016064257028",
"QNT": "0.0184774575018477",
"BOND": "0.3590664272890485",
"RLY": "22.7531285551763367",
"CLV": "11.0314396028681743",
"FARM": "0.0267094017094017",
"MASK": "0.6269592476489028",
"FET": "13.5777325186693822",
"PAX": "1.0006504227748036",
"ACH": "87.1497668743736111",
"ASM": "50.6713959969597162",
"PLA": "2.8340654669122857",
"RAI": "0.3262642740619902",
"TRIBE": "6.4808813998703824",
"ORN": "0.7990411506192569",
"IOTX": "27.0233752195649237",
"UST": "11.8056785313735907",
"QUICK": "0.0188235294117647",
"AXS": "0.070298769771529",
"REQ": "10.7991360691144708",
"WLUNA": "6577.2165219679031834",
"TRU": "15.7853196527229676",
"RAD": "0.5333333333333333",
"COTI": "10.6609808102345416",
"DDX": "1.3071895424836601",
"SUKU": "11.5207373271889401",
"RGT": "0.2378121284185493",
"XYO": "152.7883880825057296",
"ZEN": "0.0742942050520059",
"AST": "12.2925629993853719",
"AUCTION": "0.1573564122738002",
"BUSD": "1",
"JASMY": "109.7694840834248079",
"WCFG": "4.3103448275862069",
"BTRST": "0.5050505050505051",
"AGLD": "2.1561017680034498",
"AVAX": "0.0575705238917674",
"FX": "4.5248868778280543",
"TRAC": "5.2617732175743225",
"LCX": "16.9779286926994907",
"ARPA": "21.9058050383351588",
"BADGER": "0.3262642740619902",
"KRL": "1.8717828731867103",
"PERP": "1.5142337976983646",
"RARI": "0.468384074941452",
"DESO": "0.1260239445494644",
"API3": "0.5405405405405405",
"NCT": "51.3478818998716303",
"SHPING": "70.9924747976714468",
"UPI": "54.8998078506725226",
"CRO": "8.5947571981091534",
"AVT": "0.6688963210702341",
"MDT": "40.0320256204963971",
"VGX": "3.7362226788716608",
"ALCX": "0.0423998304006784",
"COVAL": "82.1018062397372742",
"FOX": "14.5243282498184459",
"MUSD": "1.0024560172422435",
"GALA": "17.8237233758132074",
"POWR": "4.5320643553138455",
"GYEN": "136.5747063643813166",
"ALICE": "0.3833620854897451",
"INV": "0.0120948234155781",
"LQTY": "0.9661835748792271",
"PRO": "1.1560693641618497",
"SPELL": "1164.8902090977925331",
"ENS": "0.1152073732718894",
"DIA": "2.6796002036496155",
"BLZ": "10.8695652173913043",
"CTX": "0.2487562189054726",
"ERN": "0.7575757575757576",
"IDEX": "16.0384923817161187",
"MCO2": "0.2150537634408602",
"POLS": "1.9579050416054821",
"SUPER": "7.9579818558013688",
"UNFI": "0.1755926251097454",
"STX": "2.2880677268047134",
"KSM": "0.0206398348813209",
"GODS": "2.1226239877736858",
"IMX": "1.0602205258693808",
"RBN": "4.1806020066889632",
"BICO": "1.8744142455482662",
"GFI": "0.881057268722467",
"ATA": "5.8633831720902961",
"GLM": "4.3535045711797997",
"MPL": "0.0867678958785249",
"PLU": "0.1418439716312057",
"SAND": "0.9699321047526673",
"FIDA": "2.7322404371584699",
"ORCA": "1.2477384740158463",
"CRPT": "7.3800738007380074",
"QSP": "44.2673749446657813",
"RNDR": "1.7565431231336729",
"PRQ": "8.7221979938944614",
"HOPR": "8.98069151324652",
"JUP": "122.1747098350641417",
"MATH": "6.8657741160315826",
"SYN": "1.4214641080312722",
"AIOZ": "18.8146754468485419",
"WAMPL": "0.2881844380403458",
"AERGO": "8.7719298245614035",
"INDEX": "0.3095975232198142",
"HIGH": "0.7719027402547279",
"GUSD": "0.9973683637826903",
"FLOW": "0.6385696040868455",
"ROSE": "20.2880908906471901",
"OP": "1.7271157167530225",
"APE": "0.2139266231682533",
"MINA": "1.6207455429497569",
"MUSE": "0.1262148176195885",
"DREP": "1.9582884558895525",
"ELA": "0.6740815638692282",
"FORT": "4.698144233027954",
"ALEPH": "3.8189803322512889",
"DEXT": "7.4211502782931354",
"FIS": "3.2206119162640902",
"BIT": "2.2750540325332727",
"GMT": "1.1594202898550725",
"GST": "7.4349442379182156",
"MEDIA": "0.047247814788566",
"C98": "2.1565667457407807",
"DAR": "3.3500837520938023",
"GAL": "0.3513703443429375",
"MONA": "0.0020586933473324",
"TIME": "0.0350508236943568",
"BOBA": "2.4495195059279964",
"POND": "103.8961038961038961",
"DYP": "3.8747675139491631",
"METIS": "0.05116398055768738",
"XCN": "11.5600254320559505"
  }
}
/**
 *
 * @param currency
 * @returns
 */
export async function getExchangeRates(currency = 'USD') {
  try {
    if (!exchangeRates) {
      exchangeRates = await cacheExchangeRates(currency)
    }
  } catch (error) {
    errorLogger.error(error)
  }

  return exchangeRates
}

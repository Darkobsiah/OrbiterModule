
import { equalsIgnoreCase, logger } from '.';
import { BigNumber } from 'bignumber.js'
import dayjs from './dayFormat'
import dayjs2 from './dayWithRelativeFormat'
import axios from 'axios'
import { makerListHistory, makerList } from '../configs'
import { utils } from 'ethers'
import * as Keyv from 'keyv';
const keyv = new Keyv();
async function getAllMakerList() {
  return makerList.concat(makerListHistory)
}
async function getMakerList() {
  return makerList
}

// ETH:18  USDC:6  USDT:6
const token2Decimals = {
  'ETH': 18,
  'USDC': 6,
  'USDT': 6
}


/**
 *
 * @param currency
 * @returns
 */
export async function cacheExchangeRates(currency = 'USD'): Promise<any> {
  // cache
  const exchangeRates = await getRates(currency)
  if (exchangeRates) {
    let metisExchangeRates = await getRates('metis')
    if (metisExchangeRates && metisExchangeRates["USD"]) {
      let usdToMetis = 1 / Number(metisExchangeRates["USD"])
      exchangeRates["METIS"] = String(usdToMetis)
    }
    return exchangeRates
  } else {
    return undefined
  }
}
export async function getRates(currency) {
  if (currency === 'ETH') {
    return {"AED":"5503.662815298902151117","AFN":"132651.804893800154631784","ALL":"178349.064684769237929018","AMD":"603055.585741136507298221","ANG":"2708.116034178901584011","AOA":"641522.92006400617178603","ARS":"210644.031144400899022","AWG":"2704.474475108644052462","AZN":"2547.229","BAM":"2963.029026163532232987","BBD":"3036.2370332","BDT":"142896.577130660070123716","BGN":"2964.225371000000149837","BHD":"564.933737514","BIF":"3102486.863402213509633802","BMD":"1498.37","BND":"2112.575986757","BOB":"10391.167480970000299674","BRL":"7864.045108000000599348","BSD":"1503.81657495","BTN":"119969.74056220972579829","BWP":"19428.867829529993706846","BYN":"3799.55016393","BYR":"37995501.6393","BZD":"3029.343613575467342748","CAD":"1967.8","CDF":"3086240.988671472708577671","CHF":"1477.507592789807979257","CLF":"48.4920629677","CLP":"1338044.410000015788924038","CNY":"10447.234829870653619024","COP":"6716136.261766024204388888","CRC":"990114.515670739362830857","CUC":"1498.37","CVE":"166485.555555555555538907","CZK":"37332.5991573586606716","DJF":"267705.471425308842209501","DKK":"11270.529368200003596088","DOP":"79781.97077916985615648","DZD":"210274.158509899684892789","EGP":"28855.70086057","ETB":"79384.345754780957550736","EUR":"1513.1900000000626869","FJD":"3365.039345999999850163","FKP":"1305.83694685","GBP":"1305.635","GEL":"4285.338199999999400652","GHS":"14962.565491149999250815","GIP":"1305.83694685","GMD":"83242.777777777777844372","GNF":"12984142.11438474870011618","GTQ":"11653.99821208","GYD":"313984.141220254310412065","HKD":"11761.75498899999700326","HNL":"37041.679753290010938101","HRK":"11384.015912000004045599","HTG":"181948.554546194170657199","HUF":"612612.281110606859681031","IDR":"22365569.641990342099735172","ILS":"5114.262572671665247774","INR":"119737.218531191914173931","IQD":"2193806.734992679355766636","ISK":"214491.665499999973179177","JMD":"226341.344840599906951223","JOD":"1062.34433","JPY":"217086.9999980612611291","KES":"180823.291599999059772825","KGS":"121444.53820537","KHR":"6186740.961296876330534883","KMF":"744165.603007712976012321","KRW":"2078224.206299912972273008","KWD":"463.064862210412536658","KYD":"1252.920661767","KZT":"710523.487879389437690196","LAK":"23412031.25","LBP":"2272323.324234152259680594","LKR":"541360.601521600199433047","LRD":"230515.269788572158290885","LSL":"25781.407007507453762351","LYD":"7413.507756780225038507","MAD":"15984.978257583281925564","MDL":"29173.382271230018729625","MGA":"6332482.616413030645263791","MKD":"93322.894711928927756334","MMK":"3157967.309066267564530248","MNT":"4800748.684325187199673651","MOP":"12150.848703172599525735","MUR":"66222.113353739934221557","MVR":"23089.881699999986364833","MWK":"1544563.20377889017968302","MXN":"30238.305296","MYR":"6748.658480000000899022","MZN":"95745.842999999871739528","NAD":"25878.583765112262484065","NGN":"635317.113709793678974518","NIO":"54035.934760327943873575","NOK":"15078.0223915","NPR":"191951.221095300889732106","NZD":"2493.543018805125600855","OMR":"576.890130766","PAB":"1502.84728262439458269","PEN":"5847.101326550601670663","PGK":"5298.541987479999400652","PHP":"85805.656420000086156275","PKR":"334579.322387386482168045","PLN":"7179.075622803508205602","PYG":"10390915.395284327323191577","QAR":"5455.565170000000749185","RON":"7348.755665","RSD":"177846.171376210817928548","RUB":"86626.20278962","RWF":"1554164.505756664246445801","SAR":"5631.29323900552917428","SBD":"12297.008713880003745925","SCR":"21793.372106400013335493","SEK":"16224.3953111","SHP":"1299.089647997225610031","SLL":"21239394.75000116816671125","SOS":"850626.458282476766833795","SRD":"39020.052083333333383279","SSP":"195177.676200000403660878","STD":"33551636.648493786304904643","SVC":"13157.883712049994456031","SZL":"25778.532782609533460952","THB":"55110.048599999900658069","TJS":"15245.63525939160724709","TMT":"5234.661390909240193987","TND":"4836.726544844396244451","TOP":"3543.083471269803729872","TRY":"27314.082693108725354065","TTD":"10185.427794640003296414","TWD":"46351.776275999947407213","TZS":"3504959.064327485380058251","UAH":"55560.39569046","UGX":"5736485.451761102603436068","UYU":"61033.401221995926621042","UZS":"16465604.39560439560441207","VES":"11889.172035574282871815","VND":"35675476.190476190476176206","VUV":"176227.1015598","WST":"4026.5547173","XAF":"994014.158394892560264819","XAG":"83.707821229050283515","XAU":"0.8840383","XCD":"4049.21089611933841556","XDR":"1109.07998867","XOF":"881394.117647058823494156","XPD":"0.75667685","XPF":"181197.884100000321400365","XPT":"1.7680766","XTS":"1498224.472528626330049596","YER":"375042.010999998541037131","ZAR":"26019.64456100001648207","ZMW":"23157.927274553821551439","JEP":"1305.83694685","GGP":"1305.83694685","IMP":"1305.83694685","GBX":"209447.993402200198566937","CNH":"10464.840567573919364154","LTL":"0","ZWD":"762987.085418014606560271","ZWL":"482475.14","VEF":"1188917203.557428294574307743","SGD":"2111.9974661","AUD":"2232.640958397902082433","USD":"1498.37","BTC":"0.08035","BCH":"13.48667866786678533","BSV":"30.476975022374145909","ETH":"1.0","ETH2":"0.999999999999958727","ETC":"44.935372619583145854","LTC":"28.10409828378499406","ZRX":"5630.6306306306306306","USDC":"1498.37","BAT":"4833.0191870861727321","LOOM":"35385.7041755130927105","MANA":"2059.9443815016994541","KNC":"873.405030456704884761","LINK":"226.3995453897128575","DNT":"34927.0396270396270047","MKR":"2.089383449420210852","CVC":"11615.27131782945731788","OMG":"896.395561006251655853","GNT":"8708.420224095200319596","DAI":"1500.76","SNT":"56350.883790898834096784","ZEC":"25.9134490800725577","XRP":"4750.813962561606258792","REP":"209.6436058700209644","XLM":"15139.408819710724871406","EOS":"1090.7920786679247135","XTZ":"1073.7678513905293676","ALGO":"5301.149831947638379323","DASH":"35.222614010343198011","ATOM":"129.55514244952666528","OXT":"14762.266009852216739173","COMP":"33.911282109313185117","ENJ":"3131.389759665621777957","REPV2":"209.6436058700209644","BAND":"1274.124149659863992466","NMR":"91.08632218844984347","CGLD":"1956.096605744125278642","UMA":"601.513448414291481338","LRC":"4643.948551061521832749","YFI":"0.175845932219857411","UNI":"260.111101466886605214","BAL":"223.971599402092725133","REN":"13312.927587738782793237","WBTC":"0.080397984429762074","NU":"10144.685172647257911084","YFII":"1.676610457764926955","FIL":"268.380798853662968908","AAVE":"18.11923332728706078","BNT":"3419.764920689261671422","GRT":"15399.486125385405976807","SNX":"547.850091407678228811","STORJ":"3076.41925880299758224","SUSHI":"1353.8211602247343126","MATIC":"1884.860683061827725871","SKL":"33371.269487750556833586","ADA":"3300.33003300330033","ANKR":"46054.095589365298974103","CRV":"1459.403915457290392724","ICP":"244.372502650248753502","NKN":"16520.066152149944828439","OGN":"9546.190112130479091348","1INCH":"2476.644628099173592107","USDT":"1497.3850000000828353","FORTH":"344.452873563218439028","CTSI":"11597.29102167182656972","TRB":"95.164814226738604413","POLY":"8691.241299303944259226","MIR":"8964.223751121746949355","RLC":"1477.1048744460856721","DOT":"219.605745273340152587","SOL":"49.0556781947510424","DOGE":"25896.474248185274871631","MLN":"69.348127600554785","GTC":"718.642685851319018505","AMP":"274678.276810265811234453","SHIB":"126391396.03542808941379055","CHZ":"7978.541001064962728379","KEEP":"10330.5785123966942149","LPT":"159.062632696390690941","QNT":"17.172311042347195883","BOND":"253.103040540540512193","RLY":"50706.260575296108326273","CLV":"16807.291082445316835272","FARM":"38.662624177525462895","MASK":"1218.186991869918679696","FET":"19663.648293963254535758","PAX":"1499.04457005652539942","ACH":"126120.112789865746418179","ASM":"70594.581861012956449849","PLA":"4633.178726035868845568","RAI":"512.263247863247892703","TRIBE":"6021.17741611412498783","ORN":"1346.84943820224715734","IOTX":"55865.9217877094972067","UST":"29759.086395233366399542","QUICK":"25.787281645297310494","AXS":"116.107710189848846373","REQ":"12950.475367329299843378","WLUNA":"3951397.679324894514797647","TRU":"24684.843492586490920284","RAD":"643.077253218884156184","COTI":"16574.889380530973516301","DDX":"2219.807407407407435155","SUKU":"18741.338336460287748768","RGT":"368.149877149877149509","XYO":"202619.337390128465129736","ZEN":"104.27070285316629578","AST":"17183.142201834862334459","AUCTION":"223.470544369873300109","BUSD":"1497.621189405297398125","JASMY":"179338.120885697187279181","WCFG":"4232.683615819209050553","BTRST":"789.446786090621685745","AGLD":"3721.27157581025697915","AVAX":"83.219661205220761106","FX":"5924.752866745749353292","TRAC":"7486.235323507369404546","LCX":"29437.524557956778023742","ARPA":"42267.136812411847652279","BADGER":"376.002509410288554171","KRL":"3773.281289347771393661","PERP":"2371.401440215240993284","RARI":"651.465217391304386914","DESO":"281.384037558685373553","API3":"922.641625615763611752","NCT":"130236.418948283355067379","SHPING":"179477.750494100736627701","UPI":"114510.508215513947238263","CRO":"13677.498858968507534364","MTL":"1387.379629629629590783","ABT":"11433.574971384967518579","AVT":"1058.918727915194323523","MDT":"65689.171416045594056884","VGX":"2073.151158768592126868","ALCX":"70.461791676463606538","COVAL":"102557.837097878165622025","FOX":"26218.197725284339480902","MUSD":"1501.372745490982017677","CELR":"95834.346018548129271202","GALA":"31955.00106632544258801","POWR":"7905.1383399209486166","GYEN":"215391.36059800186878481","ALICE":"781.622326551903965262","INV":"19.292731603682488177","LQTY":"1732.219653179190734989","PRO":"2125.347517730496397579","SPELL":"1209386.980911255498587465","ENS":"111.320208023774080383","DIA":"4129.561239113658959634","BLZ":"18063.53224834237496349","CTX":"444.620178041543048048","ERN":"982.537704918032806536","IDEX":"24245.469255663430463384","MCO2":"507.922033898305044112","POLS":"3177.879109225874933862","SUPER":"11695.507942083284605077","UNFI":"222.310089020771524024","STX":"4511.124491946409739855","KSM":"33.014652418199793898","GODS":"4831.503426037887957165","IMX":"1962.887273203641853315","RBN":"7426.680875319075051547","BICO":"3052.913610431947772364","GFI":"1933.380645161290337081","ATA":"10351.433506044904993626","GLM":"6855.959734614504643656","MPL":"80.731142241379331012","PLU":"192.716398713826296218","SWFTC":"1018260.278627251104275816","SAND":"1738.752538439222469904","GNO":"10.11352974924909106","FIDA":"3934.278587370355719106","ORCA":"1837.927016252683281234","CRPT":"11821.459566074950655462","QSP":"80062.516697835960420534","RNDR":"3256.264261653808475975","NEST":"47170.470643790335268895","PRQ":"14263.398381722989103681","HOPR":"21889.992695398100830212","JUP":"168289.998315269276199764","MATH":"11756.53197332287174085","SYN":"1130.418709920784541304","AIOZ":"27193.647912885662461583","WAMPL":"342.876430205949669437","AERGO":"13114.835886214442041326","INDEX":"786.545931758530127489","TONE":"95498.406628425748878528","HIGH":"1092.902990517870095192","GUSD":"1498.37","FLOW":"863.613832853025872692","ROSE":"26595.7446808510638298","OP":"1366.502507979936110975","APE":"356.034216466674626024","MINA":"2428.476499189627246253","MUSE":"169.825456194038286786","SYLO":"418539.10614525139659782","CBETH":"1.0821046936291086","DREP":"3201.303279564149074048","ELA":"872.159487776484294866","FORT":"6278.525036664571608221","ALEPH":"9796.469434455704455762","DEXT":"11606.274206041827990604","FIS":"4717.047064379033601808","BIT":"2450.519257502657601395","GMT":"2404.4241404183698004","GST":"43431.014492753623197092","MEDIA":"169.403052572074585649","C98":"3836.563820253488710473","AURORA":"1240.886128364389187111","BOBA":"5144.618025751072949798","DAR":"6615.320088300220722106","DYP":"9000.840992370997763408","GAL":"631.025479048220656204","LOKA":"2798.076563958916941365","METIS":"54.655115812511340033","MONA":"2.307758653883176969","MXC":"22947.698904969752630101","NEAR":"366.394424746301522684","OOKI":"261701.161470613920122028","POND":"151350.505050505050503537","RARE":"8053.58774522977693081","STG":"2137.17016117529603444","TIME":"27.004956294494037986","XCN":"20680.008281002001241685"}
  }
  if (currency === 'USDC') {
    return {"AED":"3.6730400000000004","AFN":"88.9887144512332946","ALL":"118.9749593403076454","AMD":"402.4744126892132833","ANG":"1.8073747032968503","AOA":"428.147200000004119","ARS":"140.5813900000008864","AWG":"1.8049443562729126","AZN":"1.6999999999999999","BAM":"1.9775529999999999","BBD":"2.0250982577674669","BDT":"95.3332468978561459","BGN":"1.9734200000000002","BHD":"0.3769242453882376","BIF":"2070.5746000001424946","BMD":"1","BND":"1.4099161","BOB":"6.9290840125105998","BRL":"5.2482999999999999","BSD":"1.0035850063597182","BTN":"80.0540524962454649","BWP":"12.9646498079546424","BYN":"2.5341600000000001","BYR":"25341.6","BZD":"2.0217593875848204","CAD":"1.3175404155522471","CDF":"2059.7322348094747683","CHF":"0.9831","CLF":"0.03236321","CLP":"893.0000000000105374","CNY":"6.9785998444330523","COP":"4474.2729306487695749","CRC":"660.7944070361388461","CUC":"1","CVE":"111.1111111111111111","CZK":"24.878097323116728","DJF":"178.664463","DKK":"7.5085999749813449","DOP":"53.2335381937328155","DZD":"140.4086171576521994","EGP":"19.2227999999999899","ETB":"52.9804692798046928","EUR":"1.0102","FJD":"2.2431999999999999","FKP":"0.871961","GBP":"0.8715","GEL":"2.8599999999999996","GHS":"9.9858949999999995","GIP":"0.871961","GMD":"54.999999999999945","GNF":"8671.0648999979660112","GTQ":"7.777784","GYD":"210.0372600000010016","HKD":"7.8498200000000016","HNL":"24.7109742672269468","HRK":"7.5848999999999982","HTG":"121.4309913747566827","HUF":"405.3900000000003324","IDR":"14948.4999999986875217","ILS":"3.4287238598378831","INR":"79.916","IQD":"1464.1288433382137628","ISK":"142.88","JMD":"151.0364118581707678","JOD":"0.709791214914133","JPY":"144.1700000000008342","KES":"120.3000000000001311","KGS":"81.0511010000002961","KHR":"4128.9808000005848559","KMF":"496.6999999999901951","KRW":"1387.9250520471894518","KWD":"0.3091834280156051","KYD":"0.8357001755137509","KZT":"474.1786041130252121","LAK":"15625","LBP":"1516.5301789505611162","LKR":"361.2996800000001331","LRD":"153.8440236981334105","LSL":"17.2063021867145323","LYD":"4.9479030000000007","MAD":"10.6793130000000009","MDL":"19.3986420950533463","MGA":"4224.7570764681030841","MKD":"62.29935799999993","MMK":"2107.6018000001785704","MNT":"3203.980782","MOP":"8.1093779928673155","MUR":"43.9992320000000801","MVR":"15.4074041204945284","MWK":"1030.8215647871353469","MXN":"20.1008782676741495","MYR":"4.5014974231178001","MZN":"63.8999999999999144","NAD":"17.29","NGN":"424.0054951112166414","NIO":"36.0631451245873475","NOK":"10.0276763868276443","NPR":"128.1066900000005938","NZD":"1.6587599110904688","OMR":"0.3850251402165304","PAB":"1.002988102153937","PEN":"3.9039860000000003","PGK":"3.5362039999999996","PHP":"57.1849999999998634","PKR":"223.3077100000024102","PLN":"4.7618","PYG":"6934.8127600554785021","QAR":"3.6410000000000005","RON":"4.9046000000000001","RSD":"118.48509694450632","RUB":"61.1748008760231485","RWF":"1037.2368011617052173","SAR":"3.7580972903742727","SBD":"8.2034454470877769","SCR":"13.0511688039478219","SEK":"10.7951723989032105","SHP":"0.86701","SLL":"14175.000000000779625","SOS":"568.49999999999639","SRD":"26.0416666666666667","SSP":"130.26","STD":"22392.0905040102153039","SVC":"8.7747585296137132","SZL":"17.2067610000000017","THB":"36.7199999999999812","TJS":"10.174813470232057","TMT":"3.4935706073327951","TND":"3.2279921146608623","TOP":"2.3749999999999998","TRY":"18.2352500000000161","TTD":"6.7942883135863005","TWD":"30.9370000000000276","TZS":"2332.0000000000848848","UAH":"37.013841","UGX":"3828.4839203675344564","UYU":"40.9560839999999598","UZS":"11020.2878999983181907","VES":"7.9347499000000027","VND":"23809.5238095238095238","VUV":"117.6125400000001052","WST":"2.68729","XAF":"662.5660120000199497","XAG":"0.0549646851897656","XAU":"0.000586","XCD":"2.702410550210788","XDR":"0.741833","XOF":"588.2352941176470588","XPD":"0.0005","XPF":"120.9230784113609651","XPT":"0.00116","XTS":"999.9768198255841414","YER":"250.2496239999399401","ZAR":"17.36291","ZMW":"15.4554130652334347","JEP":"0.871961","GGP":"0.871961","IMP":"0.871961","GBX":"131.1095407101679382","CNH":"6.99235","LTL":"0","ZWD":"509.3398999999953137","ZWL":"322","VEF":"793474.99000000027","SGD":"1.40769986487489","AUD":"1.4875197096361527","USD":"1","BTC":"0.0000532246415187","BCH":"0.0088597501550456","BSV":"0.0200264348940602","ETH":"0.0006589221351713","ETH2":"0.0006589221351713","ETC":"0.0292997363023733","LTC":"0.018384042650979","ZRX":"3.6792773899206196","USDC":"1.0","BAT":"3.1761156106082261","LOOM":"23.3644859813084112","MANA":"1.3554727211114876","KNC":"0.5879413234559191","LINK":"0.1488981536628946","DNT":"21.6919739696312364","MKR":"0.0014005602240896","CVC":"7.6452599388379205","OMG":"0.5755726948313572","GNT":"4.6375071655282591","DAI":"1.000050002500125","SNT":"37.1678126742241219","ZEC":"0.0173777044052481","XRP":"3.1251418033093252","REP":"0.1364256480218281","XLM":"10.0244596816231605","EOS":"0.6715916722632639","XTZ":"0.6985679357317499","ALGO":"3.4632034632034632","DASH":"0.02322340919647","ATOM":"0.0838961365829104","OXT":"9.3676814988290398","COMP":"0.022158209616663","ENJ":"2.0554984583761562","REPV2":"0.1364256480218281","BAND":"0.8333333333333333","NMR":"0.0579374275782155","CGLD":"1.265022137887413","UMA":"0.3948667324777887","LRC":"3.0206917384080955","YFI":"0.0001137608542075","UNI":"0.1707796089146956","BAL":"0.1504890895410083","REN":"8.6880973066898349","WBTC":"0.0000532230693265","NU":"6.6956812855708068","YFII":"0.001061565490629","FIL":"0.1747335313646689","AAVE":"0.0120794829981277","BNT":"2.2133687472332891","GRT":"9.9453008453505719","SNX":"0.3615328994938539","STORJ":"2.0191822311963655","SUSHI":"0.9018759018759019","MATIC":"1.2396950350213847","SKL":"21.8102508178844057","ADA":"2.1593608291945584","ANKR":"30.2297460701330109","CRV":"0.9669309611293754","ICP":"0.1606812886639351","NKN":"10.7411385606874329","OGN":"6.1553613197094669","1INCH":"1.6406890894175554","USDT":"0.9999000099990001","FORTH":"0.2272727272727273","CTSI":"7.4934432371674785","TRB":"0.0625390869293308","POLY":"5.7240984544934173","MIR":"5.9683676514473292","RLC":"0.9659036028204385","DOT":"0.1434102968593145","SOL":"0.0320461464508893","DOGE":"16.9061707523245985","MLN":"0.046178711613946","GTC":"0.45662100456621","AMP":"182.6484018264840183","SHIB":"82815.7349896480331263","CHZ":"5.3304904051172708","KEEP":"6.745362563237774","LPT":"0.1050420168067227","QNT":"0.0112139052425007","BOND":"0.1644736842105263","RLY":"30.8641975308641975","CLV":"10.9409190371991247","FARM":"0.0253421186011151","MASK":"0.7905138339920949","FET":"11.5473441108545035","PAX":"1.0004001600640256","ACH":"82.8328846552081176","ASM":"46.9924812030075188","PLA":"3.0450669914738124","RAI":"0.3412969283276451","TRIBE":"3.9123630672926448","ORN":"0.8616975441619991","IOTX":"26.1506276150627615","UST":"26.4967342775002981","QUICK":"0.017016931847188","AXS":"0.0760167236792094","REQ":"8.2918739635157546","WLUNA":"2878.7747934479085701","TRU":"16.0771704180064309","RAD":"0.3944773175542406","COTI":"10.9469074986316366","DDX":"1.4598540145985401","SUKU":"12.5","RGT":"0.2475247524752475","XYO":"136.4256480218281037","ZEN":"0.0688231245698555","AST":"10.7181136120042872","AUCTION":"0.1461988304093567","BUSD":"0.9995002498750625","JASMY":"116.8907071887784921","WCFG":"2.9895366218236173","BTRST":"0.5226025607525477","AGLD":"2.3460410557184751","AVAX":"0.0541565123206066","FX":"3.9502271380604385","TRAC":"5.0955414012738854","LCX":"18.8679245283018868","ARPA":"26.1096605744125326","BADGER":"0.2478314745972739","KRL":"2.5176233635448137","PERP":"1.5573898146706121","RARI":"0.4319654427645788","DESO":"0.1806684733514002","API3":"0.5549389567147614","NCT":"88.6917960088691796","SHPING":"119.8968886757388646","UPI":"75.700227100681302","CRO":"9.0620752152242864","MTL":"0.9140767824497258","ABT":"7.6628352490421456","AVT":"0.6968641114982578","MDT":"43.0200043020004302","VGX":"1.0006504227748036","ALCX":"0.0468164794007491","COVAL":"70.4225352112676056","FOX":"17.301038062283737","MUSD":"1.0019538099293623","CELR":"61.8238021638330757","GALA":"21.0948212213901487","POWR":"5.173305742369374","GYEN":"144.3730599870064246","ALICE":"0.5107252298263534","INV":"0.0126984126984127","LQTY":"1.1299435028248588","PRO":"1.3986013986013986","SPELL":"790.5138339920948617","ENS":"0.0747663551401869","DIA":"2.7428822206374458","BLZ":"11.813349084465446","CTX":"0.2967359050445104","ERN":"0.6430868167202572","IDEX":"15.9362549800796813","MCO2":"0.33003300330033","POLS":"2.0855057351407716","SUPER":"7.7459333849728892","UNFI":"0.1430615164520744","STX":"2.9529012254540086","KSM":"0.0214730513205927","GODS":"3.1698232823520089","IMX":"1.2721837033267604","RBN":"4.959948416536468","BICO":"2.0356234096692112","GFI":"1.2738853503184713","ATA":"6.7521944632005402","GLM":"4.5402951191827469","MPL":"0.0527704485488127","PLU":"0.1273074474856779","SWFTC":"649.5615459564793764","SAND":"1.14593479631009","GNO":"0.0067932475119731","FIDA":"2.5572177470911648","ORCA":"1.2449424214130096","CRPT":"7.8833267638943634","QSP":"55.9597090095131505","RNDR":"2.0940215684221547","NEST":"30.7881773399014778","PRQ":"9.2123445416858591","HOPR":"14.7383935151068534","JUP":"116.117045982350209","MATH":"7.5075075075075075","SYN":"0.7654037504783773","AIOZ":"18.1159420289855072","WAMPL":"0.2314814814814815","AERGO":"8.6843247937472861","INDEX":"0.5181347150259067","TONE":"64.123116383456236","HIGH":"0.7254261878853827","GUSD":"1","FLOW":"0.5589714924538849","ROSE":"17.1027877544039678","OP":"0.903750564844103","APE":"0.2347142354183781","MINA":"1.5810276679841897","MUSE":"0.113077401481314","SYLO":"280.0336040324838981","CBETH":"0.0007124257741397","DREP":"2.1034917963819941","ELA":"0.5817335660267597","FORT":"4.2553191489361702","ALEPH":"6.4641241111829347","DEXT":"7.8957757599684169","FIS":"3.0892801977139327","BIT":"1.6307893020221787","GMT":"1.5804030027657053","GST":"30.7692307692307692","MEDIA":"0.1131221719457014","C98":"2.5211143325349805","AURORA":"0.8223684210526316","BOBA":"3.4370166695308472","DAR":"4.3572984749455338","DYP":"6.0250037656273535","GAL":"0.4169272461955389","LOKA":"1.7801513128615932","METIS":"0.0353606789250354","MONA":"0.0016294739243435","MXC":"15.3586238673014898","NEAR":"0.2441704309608106","OOKI":"171.9986240110079119","POND":"99.9500249875062469","RARE":"5.1692943913155854","STG":"1.375421222749467","TIME":"0.0182498403138973","XCN":"13.8427464008859358"};
  }
  if (currency === 'BNB') {
    return {"AED":"972.12997682929105293340794","AFN":"23552.37962051652609585999562","ALL":"31488.75028702708939529532238","AMD":"106521.71136145019581292844701","ANG":"478.35251235024319923505691","AOA":"113316.4519798449301635365243","ARS":"37204.626891166168","AWG":"477.70927959797390313883022","AZN":"449.93396748999997353329603","BAM":"523.39309835985407353329603","BBD":"535.97676098494299539073593","BDT":"25231.56824144479441180429223","BGN":"522.29922948477405293340794","BHD":"99.75942421806122279223272","BIF":"548012.84986004933362395523562","BMD":"264.6670397","BND":"373.15832041236917","BOB":"1833.90015342377821393741206","BRL":"1389.05202445750997353329603","BSD":"265.61587272053228932021254","BTN":"21187.66909016968255963325653","BWP":"3431.31548541852871588010328","BYN":"670.68533462665832059988809","BYR":"6706853.346266584","BZD":"535.09307209775934792416988","CAD":"348.688238123162","CDF":"545143.23316168898043780440151","CHF":"260.228573444231","CLF":"8.565474985889437","CLP":"236347.66645210278890246413478","CNY":"1847.00536207697647707627631","COP":"1184192.57136465324383621042353","CRC":"174890.49956057171931546089017","CUC":"264.6670397","CVE":"29407.44885555555555261481067","CZK":"6584.1945149093235846573976","DJF":"47286.59452179997659177842381","DKK":"1987.41129180926134995482892","DOP":"14089.16296649214937113127535","DZD":"37161.53305148643581739211618","EGP":"5087.64157074515732686289903","ETB":"14022.18396620269903754390416","EUR":"267.25675768193798003278174","FJD":"593.70110345503997353329603","FKP":"230.7793366038517","GBP":"230.56628600052270324518011","GEL":"756.94773354199989413318412","GHS":"2642.93726840503136766648015","GIP":"230.7793366038517","GMD":"14556.6871834999854433128165","GNF":"2294945.07812903820020552104464","GTQ":"2058.5230667060248","GYD":"55589.93983089948709050696352","HKD":"2077.5833393645963589711013","HNL":"6540.18040740983273762538796","HRK":"2007.47302942052952359932854","HTG":"32138.78101499308451800120319","HUF":"107303.957905571","IDR":"3950254.3238805970149372238973","ILS":"907.48769905296289413318412","INR":"21148.66974119600730922439638","IQD":"387506.64670571010248607398316","ISK":"37818.27330273273297742364667","JMD":"39974.36001341203337070208166","JOD":"187.8583396563900708020801","JPY":"38157.84111466788707536656135","KES":"31839.44487591003469784890467","KGS":"21451.55496609578806791045517","KHR":"1092805.12531429255207970407923","KMF":"131460.11861898740496614244547","KRW":"367148.76414225160003964460286","KWD":"81.83066261718824722122247","KYD":"221.18229152999487734621073","KZT":"125499.44743967262709797162037","LAK":"4135422.4953125","LBP":"401375.55307855626327858171314","LKR":"95624.11675015733122718298407","LRD":"40717.44232772161617269989685","LSL":"4553.94106394137193281103231","LYD":"1309.54683973274928526692779","MAD":"2826.46215773972633820033573","MDL":"5134.18117749757517879994811","MGA":"1118153.94888043937474318713877","MKD":"16488.586657070494073307221","MMK":"557812.72927243872169914604488","MNT":"847988.1088276310454","MOP":"2146.28506718052010827092535","MUR":"11645.14648251353159982987997","MVR":"4077.83203803286893167557748","MWK":"272824.49201113287290725557193","MXN":"5319.80749797000293780414067","MYR":"1191.39799719376649684336397","MZN":"16912.22383682997734450140168","NAD":"4576.093116413","NGN":"112220.27920761853074471446358","NIO":"9544.72586239602094690019575","NOK":"2653.943447250956","NPR":"33905.61840806575015928817386","NZD":"439.053505487933","OMR":"101.90346407118651797305688","PAB":"265.4578918514036994902989","PEN":"1033.25641765024427940011191","PGK":"935.91664445529869413318412","PHP":"15134.84901007933775528521418","PKR":"59102.19054788672490049908494","PLN":"1260.37805430920110384368845","PYG":"1835416.36407766990291779723337","QAR":"963.65269154770013233351985","RON":"1298.21829643247013233351985","RSD":"31377.01921503818584593615252","RUB":"16190.95345209401342216849545","RWF":"274522.39363136604086683622681","SAR":"994.64448474795006054952619","SBD":"2171.18162182116489817704293","SCR":"3454.21421196585969553582943","SEK":"2857.02485143941494278229181","SHP":"229.468970090297","SLL":"3751655.2877477063410408261125","SOS":"150463.212069449044551986683","SRD":"6892.37082552083334215556799","SSP":"34475.528591322","STD":"5926448.3063881610088","SVC":"2322.38936411518625716881404","SZL":"4554.06249669541214993396749","THB":"9718.57369778399502425965364","TJS":"2692.9377606660025982316629","TMT":"924.63299062570199184366547","TND":"854.34311716223339439033331","TOP":"628.58421928749994706659206","TRY":"4826.46698920064336843545115","TTD":"1798.22417482519144380962985","TWD":"8189.80178335261131819979755","TZS":"617203.53658042246620873152656","UAH":"9797.11972915689426674202501","UGX":"1013273.50574272588056313671908","UYU":"10839.72550998452416038500406","UZS":"2916706.97513428451051122907079","VES":"2100.06676679287174460100719","VND":"6301596.18333333333333081269486","VUV":"31128.16279339786584297257644","WST":"711.23708911541297353329603","XAF":"175359.3850018746764","XAG":"14.54734051721769408889432","XAU":"0.1551844266783855961973","XCD":"715.2390003783374709642836","XDR":"196.3387440617701","XOF":"155686.49394117647058200783436","XPD":"0.13233351985","XPF":"32004.35319454588548115201447","XPT":"0.31760044764","XTS":"264660.90467185757209419627358","YER":"66232.82717010217692406232197","ZAR":"4595.49321042300663872859581","ZMW":"4090.53842331603615151225759","JEP":"230.7793366038517","GGP":"230.7793366038517","IMP":"230.7793366038517","GBX":"34702.01193153136616336882888","CNH":"1850.66045506867641773251266","LTL":"0","ZWD":"134791.58851451141966524434944","ZWL":"85222.78678340003408911471336","VEF":"210006676.679287174460100719","SGD":"372.579731796881","AUD":"393.70016156494102646670397","USD":"264.6670397","BTC":"0.01408902421489376828077","BCH":"2.3447799751937987427099","BSV":"5.30033723915569624758994","ETH":"0.17436567309117846128274","ETH2":"0.17436567309117846128274","ETC":"7.75240303749267299417488","LTC":"4.86475580737065546686983","ZRX":"973.78345502543300752179812","USDC":"264.6670397","BAT":"840.65316657931933171133727","LOOM":"6183.80933878504672501432464","MANA":"358.74895249068111675525772","KNC":"155.60868959637828163968827","LINK":"39.40549984366857105553092","DNT":"5741.15053579175703863888508","MKR":"0.37068212843136305955712","CVC":"2023.44831574923547683894385","OMG":"152.33512127316680085728084","GNT":"1227.42808019744064949561177","DAI":"264.6802737136856826299625","SNT":"9837.09495261103883760493943","ZEC":"4.60610928820047681200518","XRP":"826.96872344121822936002014","REP":"36.10737240109140420927557","XLM":"2653.1307704259872864160468","EOS":"177.60504610119447166688299","XTZ":"184.82335174581005187373739","ALGO":"916.43711807479224633333695","DASH":"6.146470963771470589859","ATOM":"22.18964910500942402991962","OXT":"2479.31653114754098025948006","COMP":"5.8645477442942680025211","ENJ":"543.4641472279260845503172","REPV2":"36.10737240109140420927557","BAND":"220.55586641666665784443201","NMR":"15.33412744495943659365535","CGLD":"334.8096643896268106012961","UMA":"104.50820916090818123111139","LRC":"799.47754025071742649989135","YFI":"0.030117485303524658193","UNI":"45.19973353257621427861532","BAL":"39.82950183596689851412951","REN":"2299.45299478714160906474553","WBTC":"0.01408639220239262776205","NU":"1772.12614462671576049662996","YFII":"0.2809613958524555209713","FIL":"46.24216645409277655109798","AAVE":"3.1949183932882579755231","BNT":"585.80575409473219139127727","GRT":"2632.19333366484337347500443","SNX":"95.68584226319594005729983","STORJ":"534.41098374558304628421035","SUSHI":"238.68606186589709230060606","MATIC":"328.00475858222827816631969","SKL":"5772.45451908396947341280629","ADA":"572.31493069521030036461916","ANKR":"8000.81740326481258015083273","CRV":"255.91475507638755582800338","ICP":"42.52704100586487106992347","NKN":"2842.82534586466166263538613","OGN":"1629.12125877138986848813593","1INCH":"434.23632436423298492874938","USDT":"264.67100976514648380043498","FORTH":"60.15159993181818903637381","CTSI":"1983.26743874110154770839645","TRB":"16.51073235807859578464414","POLY":"1514.98019290211791992776681","MIR":"1579.63019814980603983536924","RLC":"255.64284719405002845090845","DOT":"37.95597873225297608628565","SOL":"8.48155871494953246340521","DOGE":"4474.12796382385257972138318","MLN":"12.2219829000230970556562","GTC":"121.40689894495412067032544","AMP":"48341.01181735159818282162651","SHIB":"21900458.39470417873397482433768","CHZ":"1410.80511567164179397925076","KEEP":"1785.2751413153456917976278","LPT":"27.80115963235294406779119","QNT":"2.96711927914799132019242","BOND":"43.49499419884964200368681","RLY":"8131.09184946236559692699192","CLV":"2902.05087390350877564444968","FARM":"6.70722350988343863596947","MASK":"209.22295628458499038446753","FET":"3068.60335884057970017196662","PAX":"264.77294887955181801701632","ACH":"21923.13437150548767260146872","ASM":"12437.36088815789473763809636","PLA":"805.92886632155906798115228","RAI":"90.33004767918090028921047","TRIBE":"1035.47355125195619279959856","ORN":"228.75284330164216622015043","IOTX":"6924.83097069597070038873813","UST":"7012.81222294352221399453457","QUICK":"4.5038209767719007293636","AXS":"20.11912122386924433441318","REQ":"2191.85954202898550390379101","WLUNA":"761938.73704514048826017335395","TRU":"4255.09710128617364186560673","RAD":"104.40514386587770378355182","COTI":"2897.28560153256705968817302","DDX":"386.37524043795619220874197","SUKU":"3308.33799625","RGT":"65.51164349009900334982575","XYO":"36107.37240109140518854361689","ZEN":"18.21521264280799104176335","AST":"2835.21199464381359298984243","AUCTION":"38.69401165204677697036099","BUSD":"264.53477231384308672748125","JASMY":"30919.04669392523365153832717","WCFG":"791.23180777279520633670681","BTRST":"138.31567269401620399204369","AGLD":"620.91974123167156131516147","AVAX":"14.33344379637152613028202","FX":"1045.49492277305945747890845","TRAC":"1348.62185834394905773505038","LCX":"4947.0474710280373905981413","ARPA":"6910.36657180156656982174422","BADGER":"65.59282272614623280307383","KRL":"666.33192270896274026700389","PERP":"412.18975190780253509400037","RARI":"114.32701498920085501337836","DESO":"47.81699000903342878398794","API3":"146.71121934589801171146628","NCT":"23473.79509534368070929963012","SHPING":"31732.75459504825850392112462","UPI":"20035.3550113550340534816894","CRO":"2398.43262075215225303297008","MTL":"241.92599606946984156271426","ABT":"2028.09992107279693648838032","AVT":"184.43696146341462363343466","MDT":"11435.17129833657377932203525","VGX":"263.15390474770070762502071","ALCX":"12.39077901217229425943927","COVAL":"18638.52392253521125865914232","FOX":"4579.0145276816608932433589","MUSD":"265.18414879014078604978331","CELR":"16362.72270170015455046500529","GALA":"5583.69282067510548400365509","POWR":"1369.2035162959130805221478","GYEN":"38210.79039919151086376325662","ALICE":"135.17213467824309942402998","INV":"3.3619185735154054969885","LQTY":"299.05880192090396616649436","PRO":"370.16369188811188774172442","SPELL":"209222.95628458498024771990949","ENS":"19.78818988411214532771993","DIA":"725.95051758187502685519826","BLZ":"3122.91492271386431373314647","CTX":"78.53621356083086430386288","ERN":"170.20388405144693614661084","IDEX":"4217.80142948207171979044761","MCO2":"87.20495542009885624921707","POLS":"551.96462919708028214583252","SUPER":"2054.70879357192764410550245","UNFI":"37.80957710000001134287313","STX":"781.53562586741474466034142","KSM":"5.68320892634744555843019","GODS":"838.94774451224344891105333","IMX":"336.70509471407671685918788","RBN":"1312.7348644694095126537796","BICO":"538.76242178117048453808464","GFI":"337.15546458598725120041061","ATA":"1787.08332005401756217484594","GLM":"1201.66646855845630533735193","MPL":"13.96659840105541825876419","PLU":"33.73703501593370811794124","SWFTC":"171917.53147125690158589004308","SAND":"303.291170228614003540573","GNO":"1.79794870894331068303207","FIDA":"676.81125099092187364084256","ORCA":"329.49522527233114189968112","CRPT":"2086.45675758770200459402698","QSP":"14810.69052602126468105557485","RNDR":"554.21848958224268434444159","NEST":"8148.61575431034481898126866","PRQ":"2438.20395854444957534830627","HOPR":"3897.8945463917525706931669","JUP":"30735.92378353269073884886765","MATH":"1986.98978753753753555054775","SYN":"202.57714481438957885067881","AIOZ":"4794.69274818840578482703584","WAMPL":"61.26551844907407897531555","AERGO":"2298.45453495440728199595817","INDEX":"137.13318119170983509739599","TONE":"16971.2753895479320366245692","HIGH":"191.99640166848024211059319","GUSD":"264.6670397","FLOW":"147.94133018446060524753053","ROSE":"4526.54420557550879556012166","OP":"239.1929866244916330118891","APE":"62.11383236329500029762843","MINA":"418.44591256916995430223109","MUSE":"29.9278611070277712461658","SYLO":"74115.66499579949594804345457","CBETH":"0.18855629230933241617367","DREP":"556.72494678165754882986577","ELA":"153.96570081442698078226009","FORT":"1126.24272212765957108935694","ALEPH":"1710.84059276018099220740759","DEXT":"2089.75159652585866641845093","FIS":"817.63064473277727515402819","BIT":"431.61617694063926027339439","GMT":"418.28058427499013443360041","GST":"8270.844990625","MEDIA":"29.93971037330317867814558","C98":"667.25586713727468563222585","AURORA":"217.65381554276316346667452","BOBA":"909.66502732428251625703384","DAR":"1153.23328845315904958229186","DYP":"1594.61991082994426419043395","GAL":"110.32390150062525455669577","LOKA":"471.14737819314640806965004","METIS":"9.35880621287129753570538","MONA":"0.43126803982433591093695","MXC":"4064.92151282445093276574506","NEAR":"64.62386514467096821438082","OOKI":"45522.36664946680425585140243","POND":"26453.47723138430785228030193","RARE":"1368.14184388730937629054038","STG":"363.45377602307058560018394","TIME":"4.83013121087691716082281","XCN":"3666.25626402548830264545598"}
  }
  return {

  }
    const cacheData = await keyv.get(`rates:${currency}`);
  if (cacheData) {
    return cacheData;
  }
  const resp = await axios.get(
    `https://api.coinbase.com/v2/exchange-rates?currency=${currency}&timestamp=${Date.now()}`,
  )
  const data = resp.data?.data
  // check
  if (!data || !equalsIgnoreCase(data.currency, currency) || !data.rates) {
    return undefined
  }
  await keyv.set(`rates:${currency}`, data.rates, 1000 * 60 * 5); // true
  return data.rates
}

// let exchangeRates: { [key: string]: string } | undefined

/**
 * @param sourceCurrency
 * @returns
 */
export async function getExchangeToUsdRate(
  sourceCurrency = 'ETH'
): Promise<BigNumber> {
  // toUpperCase
  sourceCurrency = sourceCurrency.toUpperCase()

  const currency = 'USD'

  let rate = -1
  try {
    const exchangeRates = await cacheExchangeRates(currency)
    if (exchangeRates?.[sourceCurrency]) {
      rate = Number(exchangeRates[sourceCurrency])
    }
  } catch (error) {
    // errorLogger.error(error)
    logger.error(error)
  }

  return new BigNumber(rate)
}

/**
 * @param value
 * @param sourceCurrency
 * @returns
 */
export async function exchangeToUsd(
  value: string | number | BigNumber,
  sourceCurrency: string
): Promise<BigNumber> {
  if (!(value instanceof BigNumber)) {
    value = new BigNumber(value)
  }

  const rate = await getExchangeToUsdRate(sourceCurrency)
  if (rate.comparedTo(0) !== 1) {
    return new BigNumber(0)
  }

  return value.dividedBy(rate)
}

const GAS_PRICE_PAID_RATE = { 2: 0.8 } // arbitrum Transaction Fee = gasUsed * gasPrice * 0.8 (general)
export async function statisticsProfit(
  makerNode
): Promise<BigNumber> {
  if (makerNode.tokenName === 'USDC' || makerNode.tokenName === 'USDT') {
    return statisticsProfitOld(makerNode)
  }
  let fromToPrecision = token2Decimals[makerNode.tokenName] || 18
  let gasPrecision = token2Decimals[makerNode.tokenName] || 18 // gas default is eth, zksync is token

  if (makerNode.tokenName && Number(makerNode.toAmount) > 0) {
    const fromMinusToUsd = await exchangeToUsd(
      new BigNumber(makerNode.fromAmount)
        .minus(makerNode.toAmount)
        .dividedBy(10 ** fromToPrecision),
      makerNode.tokenName
    )
    let gasPricePaidRate = GAS_PRICE_PAID_RATE[makerNode.toChain] || 1
    if (makerNode.gasCurrency) {
      const gasAmountUsd = await exchangeToUsd(
        new BigNumber(makerNode.gasAmount)
          .multipliedBy(gasPricePaidRate)
          .dividedBy(10 ** gasPrecision),
        makerNode.gasCurrency || ''
      )
      return fromMinusToUsd.minus(gasAmountUsd || 0)
    }
    return fromMinusToUsd;
  } else {
    return new BigNumber(0)
  }
}

// old logic use makerList
export async function statisticsProfitOld(
  makerNode
): Promise<BigNumber> {
  let fromToCurrency = ''
  let fromToPrecision = 0
  let gasPrecision = 18 // gas default is eth, zksync is token

  const makerList = await getMakerList()
  for (const item of makerList) {
    if (!equalsIgnoreCase(item.makerAddress, makerNode.makerAddress)) {
      continue
    }

    if (
      equalsIgnoreCase(item.t1Address, makerNode.txToken) ||
      equalsIgnoreCase(item.t2Address, makerNode.txToken)
    ) {
      fromToCurrency = item.tName
      fromToPrecision = item.precision
    }

    if (equalsIgnoreCase(item.tName, makerNode.gasCurrency)) {
      gasPrecision = item.precision
    }
  }

  if (fromToCurrency && Number(makerNode.toAmount) > 0) {
    let fromMinusToUsd = await exchangeToUsd(
      new BigNumber(makerNode.fromAmount)
        .minus(makerNode.toAmount)
        .dividedBy(10 ** fromToPrecision),
      fromToCurrency
    )

    let gasPricePaidRate = 1
    if (GAS_PRICE_PAID_RATE[makerNode.toChain]) {
      gasPricePaidRate = GAS_PRICE_PAID_RATE[makerNode.toChain]
    }

    if (makerNode.gasCurrency) {
      const gasAmountUsd = await exchangeToUsd(
        new BigNumber(makerNode.gasAmount)
          .multipliedBy(gasPricePaidRate)
          .dividedBy(10 ** gasPrecision),
        makerNode.gasCurrency
      )
      return fromMinusToUsd.minus(gasAmountUsd || 0)
    }

    return fromMinusToUsd;
  } else {
    return new BigNumber(0)
  }
}

export async function transforeUnmatchedTradding(list = []) {
  for (const item of list) {
    item['chainName'] = await getChainName(item.chainId)

    const decimals = token2Decimals[item.tokenName]

    item['amountFormat'] = 0
    if (decimals > -1) {
      item['amountFormat'] = new BigNumber(item.value).dividedBy(
        10 ** decimals
      )
    } else {
      logger.log(`[shared/utils/maker-node.ts transforeData] maker-node.ts should Synchronize！Error decimals!`)
    }

    // time ago
    item['txTimeAgo'] = '-'
    if (item.timestamp.getTime() > 0) {
      item['txTimeAgo'] = dayjs2().to(dayjs(new Date(item.timestamp).getTime()))
    }
  }
}
/**
 * @deprecated
 * @param chainId 
 * @returns 
 */
async function getChainName(chainId: string) {
  // Temporarily, the public chain name can be obtained from chaincore
  switch (String(chainId)) {
    case "16":
      return 'Nova';
    // oether
  }
  const makerList = await getAllMakerList();
  const row1 = makerList.find(row => String(row.c1ID) == String(chainId));
  if (row1) {
    return row1.c1Name;
  }
  const row2 = makerList.find(row => String(row.c2ID) == String(chainId));
  if (row2) {
    return row2.c2Name;
  }
  return '';
}
export async function transforeData(list = []) {
  // fill data
  const makerList = await getAllMakerList();
  for (const item of list) {
    // format tokenName and amounts
    const decimals = token2Decimals[item.tokenName]
    item['fromChainName'] = await getChainName(item.fromChain)
    item['toChainName'] = await getChainName(item.toChain)
    item.decimals = decimals
    item.toTx = item.toTx || '0x'
    if (decimals > -1) {
      item.fromAmountFormat = `${new BigNumber(item.fromValue).dividedBy(
        10 ** decimals
      )}`
      item.fromValueFormat = (+item.fromAmountFormat).toFixed(6)
      item.fromAmount = item.fromValue
      item.toAmountFormat = `${new BigNumber(item.toAmount).dividedBy(
        10 ** decimals
      )}`
    } else {
      logger.log(`[shared/utils/maker-node.ts transforeData] maker-node.ts should Synchronize！Error decimals!`)
      // tmp for show
      item.fromValueFormat = new BigNumber(+item.toAmount).dividedBy(
        10 ** 18
      ).toFixed(6)
    }

    // old logic: when not toTx, dashboard ToAmount shows: 0 (NeedTo: 0.009752000000000003)
    if (!item.toTx) {
      item.toAmount = "0"
      item.toAmountFormat = "0"
    }

    // Trade duration
    item['tradeDuration'] = 0

    // Time duration、time ago
    // const tmp = item.fromTimeStamp
    item.fromTimeStamp = item.fromTimeStamp && dayjs(item.fromTimeStamp).format('YYYY-MM-DD HH:mm:ss')
    item.toTimeStamp = item.toTimeStamp && dayjs(item.toTimeStamp).format('YYYY-MM-DD HH:mm:ss')
    const dayjsFrom: any = dayjs(item.fromTimeStamp)
    item['fromTimeStampAgo'] = dayjs2().to(dayjsFrom)
    item['toTimeStampAgo'] = '-'
    if (item.toTimeStamp && item.toTimeStamp != '0') {
      const dayjsTo = dayjs(item.toTimeStamp)
      item['toTimeStampAgo'] = dayjs2().to(dayjsTo)

      item['tradeDuration'] = dayjsTo.unix() - dayjsFrom.unix()
    }

    let needTo = {
      chainId: item['toChain'],
      amount: item['toAmount'],
      decimals: 0,
      amountFormat: item['toAmountFormat'],
      tokenAddress: '',
    }
    const market = makerList.find(row => {
      return (row.c1ID == item['fromChain'] && row.c2ID == item['toChain'] && row['tName'] == item['tokenName'])
        || (row.c1ID == item['toChain'] && row.c2ID == item['fromChain'] && row['tName'] == item['tokenName'])
    });
    if (market.c1ID == item['fromChain']) {
      needTo.decimals = market.precision;
      needTo.tokenAddress = market.t2Address;
    } else if (market.c2ID == item['fromChain']) {
      needTo.decimals = market.precision;
      needTo.tokenAddress = market.t1Address;
    }
    // old:
    // if (item.state == 1 || item.state == 20) {
    // new:
    // compare two transaction to computed the old state & FE's showed state
    /*
      0: { label: 'From: check', type: 'info' },
      1: { label: 'From: okay', type: 'warning' },
      2: { label: 'To: check', type: 'info' },
      3: { label: 'To: okay', type: 'success' },
      20: { label: 'To: failed', type: 'danger' },
    */
    let state = 20
    if (item.fromStatus == 0) {
      state = 0
    } else if (item.fromStatus == 1) {
      state = 1
    }
    if (item.status == 0) {
      if (item.fromStatus == 1) state = 2
    } else if (item.status == 1) {
      state = 3
    }
    if (state == 1 || state == 20) {

      // const _fromChain = Number(item.fromChain)
      // needTo.chainId = Number(
      //   getAmountFlag(_fromChain, item.fromAmount)
      // )

      // find pool
      // const pool = await getTargetMakerPool(
      //   item.makerAddress,
      //   item.txToken,
      //   _fromChain,
      //   needTo.chainId
      // )

      // // if not find pool, don't do it
      // if (pool) {
      //   needTo.tokenAddress =
      //     needTo.chainId == pool.c1ID ? pool.t1Address : pool.t2Address

      //   needTo.amount =
      //     Number(getAmountToSend(
      //       _fromChain,
      //       needTo.chainId,
      //       item.fromAmount,
      //       pool,
      //       item.formNonce
      //     )?.tAmount || 0)
      //   needTo.decimals = pool.precision
      //   needTo.amountFormat = new BigNumber(needTo.amount)
      //     .dividedBy(10 ** pool.precision)
      //     .toString()
      // }
    }
    item['needTo'] = needTo

    // Parse to dydx txExt
    if (item.fromExt && (item.toChain == '11' || item.toChain == '511')) {
      // const dydxHelper = new DydxHelper(Number(item.toChain))
      // item.fromExt['dydxInfo'] = dydxHelper.splitStarkKeyPositionId(
      //   item.fromExt.value
      // )
      const chainId = Number(item.toChain)
      const data = item.fromExt.value
      const starkKey = utils.hexDataSlice(data, 0, 32)
      const positionId = parseInt(utils.hexDataSlice(data, 32), 16)
      item.fromExt['dydxInfo'] = { starkKey, positionId: String(positionId) }
    }
    // Profit statistics
    // (fromAmount - toAmount) / token's rate - gasAmount/gasCurrency's rate
    item['profitUSD'] = (await statisticsProfit(item)).toFixed(3)

    // old logic: when not toTx, dashboard Profit shows: 0.000 USD
    if (item.profitUSD === 'NaN' || !item.toTx) {
      item.profitUSD = "0.000"
    }
  }
  return list
}
